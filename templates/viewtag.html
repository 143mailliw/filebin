<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <meta name="description" content="Upload files and make them available for your friends. Think of it as Pastebin for files. Registration is not required.">
        <meta name="author" content="Espen Braastad">
        <link rel="icon" href="{{ .Ctx.Baseurl }}/static/img/favicon.png">

        <title>Filebin</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="{{ .Ctx.Baseurl }}/static/bootstrap/css/bootstrap.css"/>
        <link rel="stylesheet" href="{{ .Ctx.Baseurl }}/static/css/upload.css"/>
        <link rel="stylesheet" href="{{ .Ctx.Baseurl }}/static/css/custom.css"/>
        <link rel="stylesheet" href="{{ .Ctx.Baseurl }}/static/css/font-awesome.css"/>

        <script src="{{ .Ctx.Baseurl }}/static/js/jquery.js"></script>
        <script src="{{ .Ctx.Baseurl }}/static/js/showhide.js"></script>
        <script src="{{ .Ctx.Baseurl }}/static/js/upload.js"></script>
        <script src="{{ .Ctx.Baseurl }}/static/js/sorttable.js"></script>
        <script src="{{ .Ctx.Baseurl }}/static/bootstrap/js/bootstrap.js"></script>

        <script>
            window.onload = function () {
                if (typeof FileReader == "undefined") alert ("Your browser \
                    is not supported. You will need to update to a modern \
                    browser with File API support to upload files.");
                var fileCount = document.getElementById("fileCount");
                var fileList = document.getElementById("fileList");
                var fileDrop = document.body;
                var fileField = document.getElementById("fileField");
                var tag = "{{ .Data.Tag }}";
                var url = "{{ .Ctx.Baseurl }}/";
                FileAPI = new FileAPI(
                    fileCount,
                    fileList,
                    fileDrop,
                    fileField,
                    tag,
                    url
                );
                FileAPI.init();
                // Automatically start upload when using the drop zone
                fileDrop.ondrop = FileAPI.uploadQueue;
                // Automatically start upload when selecting files
                fileField.addEventListener("change", FileAPI.uploadQueue)
            }
        </script>
    </head>

    <body id="fileDrop">
        <div class="container-fluid">

            <!-- Tag meta information -->
            <div class="row">
                <div class="col-sm-6">
                    <h1 class="display-4">
                        Filebin
                    </h1>
                </div>
                <div class="col-sm-6">
                    <div class="pull-right">
                        <p>
                            <small class="text-muted pull-right">
                                {{ if eq (.Data.Files | len) 1 }}
                                    This tag contains {{ .Data.Files | len }} file.
                                {{ else }}
                                    This tag contains {{ .Data.Files | len }} files.
                                {{ end }}
                                <br/>
                                {{ if .Data.LastUpdateReadable }}
                                    Last updated {{ .Data.LastUpdateReadable }}.
                                    <br/>
                                {{ end }}
                                {{ if .Data.ExpirationReadable }}
                                    Expires {{ .Data.ExpirationReadable }}
                                    <a href="" style="text-decoration: none;" data-toggle="modal" data-target="#expiration"><i class="fa fa-question-circle"></i></a>.
                                {{ end }}
                            </small>
                        </p>
                    </div>
                </div>
            </div>

            <nav class="navbar navbar-light">
                <ul class="nav navbar-nav">
                    <li class="nav-item">
                        <a class="btn btn-secondary btn-sm" href="" data-toggle="modal" data-target="#archive">
                            <i class="fa fa-cloud-download"></i> Download files
                        </a>
                    </li>

                    <!--
                        Only show the album link if there are images in the tag.
                    -->
                    {{ if .Data.Album }}
                    <li class="nav-item">
                        <a class="btn btn-secondary btn-sm" href="{{ .Ctx.Baseurl }}/album/{{ .Data.Tag }}">
                            <i class="fa fa-image"></i> Album
                        </a>
                    </li>
                    {{ end }}

                    <li class="nav-item">
                        <div class="dropdown">
                            <a class="btn btn-link btn-sm" href="" id="dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="text-decoration: none;">More <i class="fa fa-caret-down"></i></a>

                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdown">

                                <span class="dropdown-item fileUpload">
                                    <span>
                                        <i class="fa fa-fw fa-cloud-upload text-primary"></i> Upload files
                                    </span>
                                    <input type="file" class="upload" id="fileField" multiple>
                                </span>

                                <a class="dropdown-item" href="" data-toggle="modal" data-target="#info">
                                    <i class="fa fa-fw fa-info-circle text-primary"></i> Tag properties
                                </a>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item" href="" data-toggle="modal" data-target="#delete">
                                    <i class="fa fa-fw fa-trash text-danger"></i> Delete tag
                                </a>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item" href="{{ .Ctx.Baseurl }}">
                                    <i class="fa fa-fw fa-plus text-info"></i> New tag
                                </a>

                            </div>
                        </div>
                    </li>
                </ul>
            </nav>

            <!-- Upload queue -->
            <span id="fileList"></span>

            <!-- Upload status -->
            <div id="fileCount"></div>

            <!-- Thumbnails -->
            <p class="media">
                {{ range $index, $value := .Data.Files }}
                    {{ $thumbnail := .GetLink "thumbnail" }}
                    {{ $file := .GetLink "file" }}
                    {{ if $thumbnail }}
                        <a href="{{ $file }}">
                             <img class="media-object pull-left" alt="{{ .Filename }} thumbnail" src="{{ $thumbnail }}"/>
                        </a>
                    {{ end }}
                {{ end }}
            </p>

            <!-- Existing files in the tag -->
            {{ if .Data.Files }}
                <div class="table">
                    <table class="sortable table">
	                <thead class="thead thead-default">
                            <tr>
                                <th>
                                    <i class="fa fa-tags"></i> Filename
                                </th>
                                <th class="hidden-xs-down">
                                    <i class="fa fa-database"></i> Size
                                </th>
                                <th class="hidden-sm-down">
                                    <i class="fa fa-clock-o"></i> Uploaded
                                </th>
                                {{ if .Data.Album }}
                                <th class="hidden-md-down">
                                    <i class="fa fa-clock-o"></i> Captured
                                </th>
                                {{ end }}
                                <th class="sorttable_nosort"></th>
                            </tr>
	                </thead>
	                <tbody>
                            {{ range $index, $value := .Data.Files }}
                                <tr>
                                    <td>
                                        {{ if eq .MediaType "image" }}
                                        <i class="fa fa-fw fa-file-image-o"></i>
                                        {{ else }}
                                        <i class="fa fa-fw fa-file-o"></i>
                                        {{ end }}

                                        {{ $file := .GetLink "file" }}
                                        <a href="{{ $file }}">{{ .Filename }}</a>
                                    </td>
                                    <td class="hidden-xs-down" sorttable_customkey="{{ .Bytes }}">
                                        {{ .BytesReadable }}
                                    </td>
                                    <td class="hidden-sm-down" sorttable_customkey="{{ .CreatedAt }}">
                                        {{ .CreatedReadable }}
                                    </td>
                                    {{ if $.Data.Album }}
                                        <td class="hidden-md-down" sorttable_customkey="{{ .DateTime }}">
                                            {{ .DateTimeString }}
                                        </td>
                                    {{ end }}

                                    <td>
                                        <div class="pull-right">
                                            <div class="dropdown">
                                                <a href="" class="small" id="dropdown-{{ $index }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="text-decoration: none;">More <i class="fa fa-caret-down"></i></a>
                                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdown-{{ $index }}">
                                                    {{ if .Longitude }} {{ if .Latitude }}
                                                        <a class="dropdown-item" target="_blank" href="https://maps.google.com/?q={{ .Latitude }},{{ .Longitude }}"  alt="Show location in Google Maps">
                                                            <i class="fa fa-fw fa-globe text-warning"></i> Google Maps
                                                        </a>
                                                    {{ end }} {{ end }}

                                                    <a class="dropdown-item" href="" data-toggle="modal" data-target="#info-{{ $index }}">
                                                        <i class="fa fa-fw fa-info-circle text-primary"></i> File properties
                                                    </a>

                                                    <div class="dropdown-divider"></div>
                                        
                                                    <a class="dropdown-item" href="" data-toggle="modal" data-target="#delete-{{ $index }}">
                                                        <i class="fa fa-fw fa-trash text-danger"></i> Delete file
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {{ end }}
	                <tbody>
                    </table>
                </div>
            {{ end }}
        </div>

        <!-- Modals start -->
        {{ range $index, $value := .Data.Files }}
            <!-- File info modal start -->
            <div class="modal fade" id="info-{{ $index }}" tabindex="-1" role="dialog" aria-labelledby="info-{{ $index }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                          <h4 class="modal-title">File properties</h4>
                        </div>

                        <div class="modal-body">
                            {{ $thumbnail := .GetLink "thumbnail" }}
                            {{ $file := .GetLink "file" }}
                            {{ if $thumbnail }}
                            <div class="pull-right">
                                <a href="{{ $file }}">
                                    <img alt="{{ .Filename }} thumbnail" src="{{ $thumbnail }}"/>
                                </a>
                            </div>
                            {{ end }}

                            <ul class="dl-horizontal">
                                <dt class="col-sm-3">Filename</dt>
                                <dd class="col-sm-9">
                                    {{ $file := .GetLink "file" }}
                                    <a href="{{ $file }}">
                                        {{ .Filename }}
                                    </a>
                                </dd>

                                <dt class="col-sm-3">Tag</dt>
                                <dd class="col-sm-9">
                                    {{ $tag := .GetLink "tag" }}
                                    <a href="{{ $tag }}">
                                        {{ .Tag }}
                                    </a>
                                </dd>

                                <dt class="col-sm-3">Size</dt>
                                <dd class="col-sm-9">
                                    {{ .BytesReadable }}
                                    ({{ .Bytes }} bytes)
                                </dd>

                                <dt class="col-sm-3">MIME</dt>
                                <dd class="col-sm-9">
                                    {{ .MIME }}
                                </dd>

                                {{ if .Longitude }} {{ if .Latitude }}
                                    <dt class="col-sm-3">Location</dt>
                                    <dd class="col-sm-9">
                                        Latitude: <code>{{ .Latitude }}</code><br/>
                                        Longitude: <code>{{ .Longitude }}</code><br/>
                                    </dd>
                                {{ end }} {{ end }}

                                {{ if ne .DateTimeString "" }}
                                    <dt class="col-sm-3">Captured</dt>
                                    <dd class="col-sm-9">
                                        {{ .DateTimeReadable }} ({{ .DateTimeString }})
                                    </dd>
                                {{ end }}

                                <dt class="col-sm-3">Uploaded</dt>
                                <dd class="col-sm-9">
                                    {{ .CreatedReadable }} ({{ .CreatedAt.Format "2006-01-02 15:04:05 UTC" }})
                                </dd>

                                <dt class="col-sm-3">Expires</dt>
                                <dd class="col-sm-9">
                                    {{ if $.Data.ExpirationReadable }}
                                        {{ $.Data.ExpirationReadable }}
                                    {{ end }}
                                    ({{ $.Data.ExpirationAt.Format "2006-01-02 15:04:05 UTC" }})
                                </dd>
                            </ul>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- File info modal end -->
            <!-- File delete modal start -->
            <div class="modal fade" id="delete-{{ $index }}" tabindex="-1" role="dialog" aria-labelledby="delete-{{ $index }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                          <h4 class="modal-title">Delete file</h4>
                        </div>
                        <div class="modal-body">

                            <p>You are free to delete any file in this tag. However you are encouraged to delete the files that you have uploaded only, or files with obvious malicious or illegal content. This action is not reversible.</p>

                            {{ $file := .GetLink "file" }}
                            <p class="lead">Delete the file <a href="{{ $file }}">{{ .Filename }}</a>?</p>

                            <div id="deleteStatus-{{ $index }}"></div>
                        </div>

                        <div class="modal-footer">
                            <div class="pull-left">
                            <button type="button" class="btn btn-danger" id="deleteButton-{{ $index }}" onclick="deleteURL('{{ $.Ctx.Baseurl }}/{{ $.Data.Tag }}/{{ .Filename }}', 'deleteStatus-{{ $index }}')"><i class="fa fa-trash-o"></i> Confirm</button>
                            </div>
                            <a href="{{ $.Ctx.Baseurl }}/{{ $.Data.Tag }}" class="btn btn-secondary"><i class="fa fa-close"></i> Close</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- File delete modal end -->
        {{ end }}

        <!-- Expiration modal start -->
        <div class="modal fade" id="expiration" tabindex="-1" role="dialog" aria-labelledby="expiration" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      <h4 class="modal-title">Expiration</h4>
                    </div>
                    <div class="modal-body">

                        <p>Tags are automatically expired after a period of time. Files inherit the expiration time from their tags.</p>

                        <p>Expired files are deleted and are no longer accessible. It is not possible to view or upload files to expired tags.</p>

                        <p>The expiration time of a tag is renewed whenever a file is uploaded, which means that tags can potentially be long lived if files are uploaded in intervals.</p>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i> Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Expiration modal end -->
        <!-- Tag info modal start -->
        <div class="modal fade" id="info" tabindex="-1" role="dialog" aria-labelledby="info" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      <h4 class="modal-title">Tag properties</h4>
                    </div>
                    <div class="modal-body">
                        <ul class="dl-horizontal">
                            <dt class="col-sm-3">Tag</dt>
                            <dd class="col-sm-9">
                                <a href="{{ $.Ctx.Baseurl }}/{{ $.Data.Tag }}">
                                    {{ $.Data.Tag }}
                                </a>
                            </dd>

                            <dt class="col-sm-3">Files</dt>
                            <dd class="col-sm-9">
                                {{ $.Data.Files | len }}
                            </dd>

                            <dt class="col-sm-3">Size</dt>
                            <dd class="col-sm-9">
                                {{ $.Data.BytesReadable }}
                                ({{ $.Data.Bytes }} bytes)
                            </dd>

                            <dt class="col-sm-3">Last updated</dt>
                            <dd class="col-sm-9">
                                {{ $.Data.LastUpdateReadable }}
                                ({{ $.Data.LastUpdateAt.Format "2006-01-02 15:04:05 UTC" }})
                            </dd>

                            <dt class="col-sm-3">Expires</dt>
                            <dd class="col-sm-9">
                                {{ if $.Data.ExpirationReadable }}
                                    {{ $.Data.ExpirationReadable }}
                                {{ end }}
                                ({{ $.Data.ExpirationAt.Format "2006-01-02 15:04:05 UTC" }})
                            </dd>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i> Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Tag info modal end -->
        <!-- Tag delete modal start -->
        <div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="delete" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      <h4 class="modal-title">Delete tag</h4>
                    </div>
                    <div class="modal-body">

                        <p>You are free to delete this tag. However you are encouraged to delete your own tags only, or tags that are being used to share obvious malicious or illegal content. This action is not reversible.</p>

                        <p class="lead">Delete all the files in tag <a href="{{ $.Ctx.Baseurl }}/{{ $.Data.Tag }}">{{ $.Data.Tag }}</a>?</p>

                        <div id="deleteStatus"></div>
                    </div>

                    <div class="modal-footer">
                        <div class="pull-left">
                        <button type="button" class="btn btn-danger" id="deleteButton" onclick="deleteURL('{{ $.Ctx.Baseurl }}/{{ $.Data.Tag }}','deleteStatus')"><i class="fa fa-trash-o"></i> Confirm</button>
                        </div>
                        <a href="{{ $.Ctx.Baseurl }}/{{ $.Data.Tag }}" class="btn btn-secondary"><i class="fa fa-close"></i> Close</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Tag delete modal end -->
        <!-- Tag archive modal start -->
        <div class="modal fade" id="archive" tabindex="-1" role="dialog" aria-labelledby="archive" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      <h4 class="modal-title">Download files</h4>
                    </div>
                    <div class="modal-body">

                    <p>
                        The files in this tag can be downloaded as a single tar archive. The default filename of the archive is <code>{{ .Data.Tag }}.tar</code> and the estimated size is {{ .Data.BytesReadable }}. 
                    </p>

                    <p class="lead">Download as archive?</p>

                    <div class="modal-footer">
                        <div class="pull-left">
                            <a class="btn btn-success" href="{{ .Ctx.Baseurl }}/archive/{{ $.Data.Tag }}"><i class="fa fa-cloud-download"></i> Confirm</a>
                        </div>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close"><i class="fa fa-close"></i> Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Tag archive modal end -->
        <!-- Modals end -->
    </body>
</html>
